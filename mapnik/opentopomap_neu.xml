<?xml version="1.0" encoding="utf-8"?>
<!-- TODO:
	- generalize rivers
	- subway stations
	- bathymetry idea: sea polygons instead of land polygons, comp-op with bathy file
	- add to database: lanes
	- Tunnelportale
	- Tunnel z17
	- Beschriftungen Labelpositionen checken
-->
<!DOCTYPE Map
[
	<!ENTITY basemap SYSTEM "styles-otm/basemap.xml">
	<!ENTITY landuse-lowzoom SYSTEM "styles-otm/landuse-lowzoom.xml">
	<!ENTITY landuse SYSTEM "styles-otm/landuse.xml">
	<!ENTITY landuse-over-hillshade SYSTEM "styles-otm/landuse-over-hillshade.xml">
	<!ENTITY hillshade SYSTEM "styles-otm/hillshade.xml">
	<!ENTITY water-casing-lowzoom SYSTEM "styles-otm/water-casing-lowzoom.xml">
	<!ENTITY water-fill-lowzoom SYSTEM "styles-otm/water-fill-lowzoom.xml">
	<!ENTITY waterway-lines-lowzoom SYSTEM "styles-otm/waterway-lines-lowzoom.xml">
	<!ENTITY waterway-lines SYSTEM "styles-otm/waterway-lines.xml">
	<!ENTITY waterway-polygons-casing SYSTEM "styles-otm/waterway-polygons-casing.xml">
	<!ENTITY waterway-polygons-fill SYSTEM "styles-otm/waterway-polygons-fill.xml">
	<!ENTITY water-areas SYSTEM "styles-otm/water-areas.xml">
	<!ENTITY water-weir SYSTEM "styles-otm/water-weir.xml">
	<!ENTITY waterway-arrows SYSTEM "styles-otm/waterway-arrows.xml">
	<!ENTITY tunnels-casing SYSTEM "styles-otm/tunnels-casing.xml">
	<!ENTITY tunnels-fill SYSTEM "styles-otm/tunnels-fill.xml">
	<!ENTITY tunnels-middle SYSTEM "styles-otm/tunnels-middle.xml">
	<!ENTITY cliffs SYSTEM "styles-otm/cliffs.xml">
	<!ENTITY borders-lowzoom SYSTEM "styles-otm/borders-lowzoom.xml">
	<!ENTITY borders SYSTEM "styles-otm/borders.xml">
	<!ENTITY buildings SYSTEM "styles-otm/buildings.xml">
	<!ENTITY housenumbers SYSTEM "styles-otm/housenumbers.xml">
	<!ENTITY roads-casing-lowzoom SYSTEM "styles-otm/roads-casing-lowzoom.xml">
	<!ENTITY roads-fill-lowzoom SYSTEM "styles-otm/roads-fill-lowzoom.xml">
	<!ENTITY roads-casing SYSTEM "styles-otm/roads-casing.xml">
	<!ENTITY roads-fill SYSTEM "styles-otm/roads-fill.xml">
	<!ENTITY road-names-text SYSTEM "styles-otm/road-names-text.xml">
	<!ENTITY bridges-casing SYSTEM "styles-otm/bridges-casing.xml">
	<!ENTITY bridges-fill SYSTEM "styles-otm/bridges-fill.xml">
	<!ENTITY bridges-middle SYSTEM "styles-otm/bridges-middle.xml">
	<!ENTITY powerlines SYSTEM "styles-otm/powerlines.xml">
	<!ENTITY powertowers SYSTEM "styles-otm/powertowers.xml">
	<!ENTITY motorway_junctions SYSTEM "styles-otm/motorway_junctions.xml">
	<!ENTITY admin_centers SYSTEM "styles-otm/admin_centers.xml">
	<!ENTITY rails-highspeed SYSTEM "styles-otm/rails-highspeed.xml">
	<!ENTITY text-capitals SYSTEM "styles-otm/text-capitals.xml">
	<!ENTITY text-cities SYSTEM "styles-otm/text-cities.xml">
	<!ENTITY text-towns SYSTEM "styles-otm/text-towns.xml">
	<!ENTITY text-villages SYSTEM "styles-otm/text-villages.xml">
	<!ENTITY text-roads-ref SYSTEM "styles-otm/text-roads-ref.xml">
	
	<!ENTITY % entities SYSTEM "inc/entities.xml.inc">
	%entities;     
]>
<!-- background-color="#222222" -->
<Map background-color="#97d2e3" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over" buffer-size="256">
	<!-- style definitions -->
	&landuse-lowzoom;
	&landuse;
	&landuse-over-hillshade;
	&water-casing-lowzoom;
	&water-fill-lowzoom;
	&waterway-lines-lowzoom;
	&waterway-lines;
	&waterway-polygons-casing;
	&waterway-polygons-fill;
	&water-areas;
	&water-weir;
	&waterway-arrows;
	&tunnels-casing;
	&tunnels-fill;
	&tunnels-middle;
	&cliffs;
	&borders-lowzoom;
	&borders;
	&buildings;
	&housenumbers;
	&roads-casing-lowzoom;
	&roads-fill-lowzoom;
	&roads-casing;
	&roads-fill;
	&road-names-text;
	&bridges-casing;
	&bridges-fill;
	&bridges-middle;
	&powerlines;
	&powertowers;
	&motorway_junctions;
	&admin_centers;
	&rails-highspeed;
	&text-capitals;
	&text-cities;
	&text-towns;
	&text-villages;
	&text-roads-ref;

	<!-- layers -->
	
	&basemap;
	
	<Layer name="landuse-lowzoom">
		<StyleName>landuse-lowzoom</StyleName>
		<Datasource>
			<Parameter name="type">shape</Parameter>
			<Parameter name="file">data/landuse/landuse-lowzoom</Parameter>
		</Datasource>
	</Layer>
	
	<Layer name="landuse">
		<StyleName>landuse</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,way_area,landuse,leisure,"natural",wetland,wood,amenity FROM &prefix;_polygon) AS landuse </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	
	&hillshade;
	
	<Layer name="landuse-over-hillshade">
		<StyleName>landuse-over-hillshade</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,landuse,"natural",wood,amenity FROM &prefix;_polygon) AS landuse </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	
	<Layer name="water-lowzoom">
		<StyleName>water-casing-lowzoom</StyleName>
		<StyleName>water-fill-lowzoom</StyleName>
		<Datasource>
			<Parameter name="type">shape</Parameter>
			<Parameter name="file">data/water/water-lowzoom</Parameter>
		</Datasource>
	</Layer>
	
	<!--<Layer name="waterway-lines-lowzoom">
		<StyleName>waterway-lines-lowzoom</StyleName>
		<Datasource>
			<Parameter name="type">shape</Parameter>
			<Parameter name="file">data/test/waterways-test</Parameter>
		</Datasource>
	</Layer>-->
	
	<Layer name="waterway-lines">
		<StyleName>waterway-lines</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,"CEMT",intermittent,motorboat,tunnel,waterway FROM &prefix;_line) AS water </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>

	<Layer name="water-polygons">
		<StyleName>waterway-polygons-casing</StyleName>
		<StyleName>waterway-polygons-fill</StyleName>
		<StyleName>water-areas</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,"CEMT",motorboat,"natural",landuse,leisure,waterway,way_area FROM &prefix;_polygon) AS water </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>

	<Layer name="water-weir-arrows">
		<StyleName>water-weir</StyleName>
		<StyleName>waterway-arrows</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,waterway,intermittent FROM &prefix;_line) AS water </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	
	<Layer name="tunnels">
		<StyleName>tunnels-casing</StyleName>
		<StyleName>tunnels-fill</StyleName>
		<StyleName>tunnels-middle</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,highway,tracktype,ST_Length(way) AS length FROM &prefix;_line WHERE (tunnel = 'yes') AND highway IS NOT NULL) AS roads </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	
	<Layer name="cliffs-lines">
		<StyleName>cliffs</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,"natural","man_made",highway FROM &prefix;_line) AS cliff </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	<Layer name="cliffs-polygons">
		<StyleName>cliffs</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,area,"natural","man_made",NULL AS highway FROM &prefix;_polygon WHERE (area != 'yes')) AS cliff </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	
	<Layer name="borders-lowzoom">
		<StyleName>borders-lowzoom</StyleName>
		<Datasource>
			<Parameter name="type">shape</Parameter>
			<Parameter name="file">data/borders/borders-lowzoom</Parameter>
		</Datasource>
	</Layer>
	
	<Layer name="borders">
		<StyleName>borders</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,boundary,admin_level,name FROM &prefix;_line WHERE boundary IN ('administrative')) AS borders </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	
	<Layer name="buildings">
		<StyleName>buildings</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,building,leisure,railway,amenity,aeroway FROM &prefix;_polygon WHERE (building IS NOT NULL AND building != 'no') OR (aeroway = 'terminal')) AS buildings </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	
	<Layer name="roads-lowzoom">
		<StyleName>roads-casing-lowzoom</StyleName>
		<StyleName>roads-fill-lowzoom</StyleName>
		<Datasource>
			<Parameter name="type">shape</Parameter>
			<Parameter name="file">data/roads/roads-lowzoom</Parameter>
		</Datasource>
	</Layer>
	
	<Layer name="roads">
		<StyleName>roads-casing</StyleName>
		<StyleName>roads-fill</StyleName>
		<StyleName>road-names-text</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,highway,name,service,surface,tracktype,embankment FROM &prefix;_line WHERE (!scale_denominator! &gt; 300000) OR ((bridge IS NULL OR bridge != 'yes') AND (tunnel IS NULL OR tunnel != 'yes')) AND highway IS NOT NULL ORDER BY (CASE WHEN highway IN ('motorway','trunk') THEN 0 WHEN highway='primary' THEN 1 WHEN highway='secondary' THEN 2 WHEN highway='tertiary' THEN 3 ELSE 4 END) DESC ) AS roads</Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	
	<Layer name="buildings-housenumbers-points">
		<StyleName>housenumbers</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,"addr:housenumber",name FROM &prefix;_point WHERE "addr:housenumber" IS NOT NULL) AS housenumbers </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	<Layer name="buildings-housenumbers-polygons">
		<StyleName>housenumbers</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,"addr:housenumber",name FROM &prefix;_polygon WHERE "addr:housenumber" IS NOT NULL) AS housenumbers </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	
	<Layer name="bridges">
		<StyleName>bridges-casing</StyleName>
		<StyleName>bridges-fill</StyleName>
		<StyleName>bridges-middle</StyleName>
		<StyleName>road-names-text</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,ST_Length(way) AS length,highway,service,surface,tracktype,layer,name,railway FROM &prefix;_line WHERE (bridge = 'yes') AND (highway IS NOT NULL OR railway = 'tram') AND (layer IS NULL OR layer &lt;= '1')) AS roads </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>

	<Layer name="bridges-layer2">
		<StyleName>bridges-casing</StyleName>
		<StyleName>bridges-fill</StyleName>
		<StyleName>bridges-middle</StyleName>
		<StyleName>road-names-text</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,ST_Length(way) AS length,highway,service,surface,tracktype,layer,name,railway FROM &prefix;_line WHERE (bridge = 'yes') AND (highway IS NOT NULL OR railway = 'tram') AND (layer = '2')) AS roads </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>

	<Layer name="bridges-layer3" group-by="layer">
		<StyleName>bridges-casing</StyleName>
		<StyleName>bridges-fill</StyleName>
		<StyleName>bridges-middle</StyleName>
		<StyleName>road-names-text</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,ST_Length(way) AS length,highway,service,surface,tracktype,layer,name,railway FROM &prefix;_line WHERE (bridge = 'yes') AND (highway IS NOT NULL OR railway = 'tram') AND (layer &gt; '2')) AS roads </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	
	<Layer name="powerlines">
		<StyleName>powerlines</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,power,voltage FROM &prefix;_line) AS powerlines </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	<Layer name="powertowers">
		<StyleName>powertowers</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,power FROM &prefix;_point WHERE power IN ('tower','pole')) AS powertowers </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	
	<!--<Layer name="motorway_junctions">
		<StyleName>motorway_junctions</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way FROM &prefix;_point WHERE (highway = 'motorway_junction')) AS junction </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>-->
	
	<!--<Layer name="admin_centers">
		<StyleName>admin_centers</StyleName>
		<Datasource>
			<Parameter name="type">shape</Parameter>
			<Parameter name="file">data/admin_centers/admin_centers</Parameter>
		</Datasource>
	</Layer>-->
	
	<!--<Layer name="rails-highspeed">
		<StyleName>rails-highspeed</StyleName>
		<Datasource>
			<Parameter name="type">shape</Parameter>
			<Parameter name="file">data/rails/rails-highspeed</Parameter>
		</Datasource>
	</Layer>-->
	
	<Layer name="text" clear-label-cache="on">
		<StyleName>text-capitals</StyleName>
		<StyleName>text-cities</StyleName>
		<StyleName>text-towns</StyleName>
		<StyleName>text-villages</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,admin_level,name,capital,place,population::INTEGER FROM &prefix;_point WHERE place IN ('city','town','village','suburb','hamlet','isolated_dwelling','locality') AND (population IS NULL OR population SIMILAR TO '[[:digit:]]+') order by (CASE WHEN place='city' THEN 0 WHEN place='town' THEN 1 WHEN place='village' THEN 2 ELSE 3 END) asc, (CASE WHEN population IS NUll THEN 0 WHEN population similar to '[[:digit:]]+' THEN population::integer ELSE 0 END) desc
		  ) AS names</Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	
	<Layer name="text-roads-ref">
		<StyleName>text-roads-ref</StyleName>
		<Datasource>
			<Parameter name="table">(SELECT way,highway,ref FROM &prefix;_line WHERE (ST_Length(way)::integer &gt; 1000) AND ref IS NOT NULL) AS roads </Parameter>
			&datasource-settings;
		</Datasource>
	</Layer>
	
	
</Map>

<!--
macros:
	!scale_denominator!
	!bbox!
-->
